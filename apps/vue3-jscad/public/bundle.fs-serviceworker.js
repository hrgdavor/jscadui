(()=>{var M=1,g=new Map,m="__RESPONSE__",E=Symbol.for("__transferable__");var x=(e,o,t)=>async c=>{let{method:d,params:n,id:r,error:s,stack:a}=c.data;if(r&&d===m){let i=g.get(r);if(!i)return console.error(`req ${r} not found`);g.delete(r);let[l,p]=i;s?(s.stack=a,p(s)):l(n);return}let f=e[d];if(!f){let i="no handler for type: "+d;throw console.error(i,c),new Error(i)}try{let i=await f(n);r&&o(i,r)}catch(i){console.error(`error executing command ${d}`,n,i),t(i,r)}},h=e=>e?e.map(o=>o.buffer||o):[],S=e=>({sendCmd:(n,r={},s=[],a)=>{let f=M++;return e.postMessage({method:n,params:r,id:f},h(s)),new Promise((l,p)=>{g.set(f,[l,p]),a&&setTimeout(()=>{p("timeout")},a)})},sendNotify:(n,r={},s=[])=>{e.postMessage({method:n,params:r},h(s))},sendResponse:(n,r)=>{let s=n?.[E];s&&delete n[E];try{e.postMessage({method:m,params:n,id:r},h(s))}catch(a){throw console.error("failed to send ",n,s),a}},sendError:(n,r)=>{try{let s=n.stack;e.postMessage({method:m,error:n,stack:s,id:r})}catch(s){throw console.error("failed to send ",s),s}}}),R=(e,o)=>{let t=S(e.postMessage?e:e.controller);return t.listener=x(o,t.sendResponse,t.sendError),t.self=e,e.addEventListener?.("message",t.listener),t};var w={},u=new URL(location.toString()).searchParams.get("prefix"),L=u+"init";self.addEventListener("activate",e=>{e.waitUntil(clients.claim())});self.addEventListener("install",e=>{self.skipWaiting()});var y=async e=>{let o=w[e];return o||(o=w[e]=R(await clients.get(e),{}),o.cache=await caches.open(u+e)),o};self.addEventListener("fetch",async e=>{let o=e.request.url,t=new URL(o).pathname;if(t===L){let c=e.clientId;e.respondWith(new Response(c)),y(c)}else if(t.startsWith(u)){t=t.substring(u.length);let c=t.indexOf("/"),d=t.substring(0,c);t=t.substring(c),e.respondWith(new Promise(async(n,r)=>{let s=await y(d),a=!1;setTimeout(()=>{a||n(new Response("timeout for "+t,{status:404}))},1e3);let f=Date.now(),i=new Request(t),l=await s.cache.match(i);if(l)return n(l),a=!0;let p=await s.sendCmd("getFile",{path:t});l=await s.cache.match(i),a=!0,n(l||new Response(t+" not in cache",{status:l?200:404}))}))}});self.addEventListener("message",e=>{w[e.source.id]?.listener(e)});})();
//# sourceMappingURL=bundle.fs-serviceworker.js.map
